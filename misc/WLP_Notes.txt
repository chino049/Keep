To get the latest build from artifactory 
https://artifactory.scm.tripwire.com/artifactory/list/libs-tripwire-local/com/tripwire/app/wlp/bundle/whitelist-profiler/
The scm/dev artifacts are built by TeamCity build config: https://teamcity.scm.tripwire.com/viewType.html?buildTypeId=AppDev_WhitelistProfiler
or 
https://artifactory.scm.tripwire.com
https://teamcity.scm.tripwire.com/
or
[2:37 PM] Jon Smith: it's probably easier to access in teamcity
[2:38 PM] Jon Smith: https://teamcity.scm.tripwire.com/project.html?projectId=AppMaster&tab=projectOverview
[2:38 PM] Jon Smith: click on wlp installer for windows
[2:38 PM] Jon Smith: https://teamcity.scm.tripwire.com/viewType.html?buildTypeId=AppMaster_WlpInstallerWindowsAmd64
[2:38 PM] Jon Smith: click on latest artifact "view": https://teamcity.scm.tripwire.com/viewLog.html?buildId=4569334&tab=artifacts&buildTypeId=App...

WLP dev
cd E:\dev\repos
git clone https://github.scm.tripwire.com/tw-app/wlp-common
git clone https://github.scm.tripwire.com/tw-app/wlp-client
git clone https://github.scm.tripwire.com/tw-app/wlp-server
git clone https://github.scm.tripwire.com/tw-app/wlp-content
git clone https://github.scm.tripwire.com/tw-app/wlp-installer
git clone https://github.scm.tripwire.com/tw-app/wlp-bundle


You can just build it with the 'build' task. 
Then you'll need to rename it to just "wlp-common-5.1.0.0.jar"
and copy it into your WLP install in 2 places:
<wlp_root>/lib
<wlp_root>/data/wlp-client-files/lib

--
gradle 4.6, get latest, upgrade, gradlew 
Basically you change the gradle version specified in each build.gradle file (near the end).
Then you need to run the gradle task 'wrapper' like 3 times. The first couple actually 
update it. You want to keep running ito until gradle tells you the task is "UP TO DATE"
----

gradle task signtool is special in that it signs the Windows MSI file/artifact with TW's build signing cert. 
They don't let anyone but the build agents have access to it for security, so that task will always fail locally
 unless you tell gradle to skip it:
----

All of the WLP repos are git repos that contain an IntelliJ IDEA project. So you can think of a repo analogous to a project.
Each of these projects are really gradle projects, which means that they use gradle to build the project.
When the project builds something, that 'thing' is called an artifact. So in other words, an artifact is the project of the build process.
SCM has an artifact repository called Artifactory. This 'repo' is not to be confused with a git repo. Artifact repos are collections of artifacts. 
Git repos are collections of files that form a project. Because we use gradle to build WLP artifacts in each of the 6 WLP git repos, gradle handles 
all of the dependency management for us. That means that gradle is responsible for determining what dependencies there are, locating them, 
downloading them if need be, and then using them when it builds the artifacts for that repo. So the wlp-bundle git repo has dependencies 
on wlp-common, wlp-client, wlp-server, wlp-content, and wlp-installer artifacts. This means that when you run the gradle task 'makeBundle' 
in wlp-bundle, gradle determines that it needs artifacts for all of the above and goes and finds them. But it only knows to look for them in artifact repos, which really means it looks in Artifactory.
So in other words, an artifact is the PRODUCT of the build process."

----
So for the GRC-ready report output, it currently ends with a newline.
If a customer uses TE to make an XML element contents report of this content, then they end up with a extra newline at the end.
So we need to remove that extra newline. You'll need to make changes to the Reporter classes in wlp-common
yeah, it used to be called 'sigmaflow report' but we can't use another product name in our feature name

[3:05 PM] Daniel Kuhn: For example, in the GroupsReporter class, the GRC report output begins on line 104 and goes through 
113: https://github.scm.tripwire.com/tw-app/wlp-common/blob/scm/dev/src/main/java/com/tripwire/app/wlp/co...
[3:06 PM] Daniel Kuhn: You can see that line 113 appends a newline to the end of each report line. Normally this is good,
 as it allows us to report one group membership on each line. However, we don't want a newline after the very last report item, 
 if that makes sense. So you need to come up with a good way to trim off the very last newline.
[3:07 PM] Daniel Kuhn: Whatever solution you come up with will then need to also be added to the other 6 Reporter subclasses.

 B-90751: Stripped trailing newline from GRC-ready report output
[5:25 PM] Daniel Kuhn:
 This 'GRC-ready' output is only created by WLP when the tw.wlp.server.enableGrcReadyOutput is set to true (default is false). 
 So if you set that GV to true and check the 'Run Whitelist Profiler' rule against your TE Console node, any nodes you've 
 previously checked with the WLP query rules will not have new GRC-ready elements associated with their output rules.
[5:28 PM] Daniel Kuhn: To 'see' the extra newline, you can create a new element contents report scoped to one of these 
GRC-ready elements and then export it as XML. You should see any extra line like this:

------------------
C:\Program Files\Tripwire\whitelist-profiler\bin>whitelist-profiler.cmd createCSRules

------------------------------------------------------------------SSR groupmembership

On a clean/empty/fresh Console, import the latest rules XML file (or just install WLP to do this)
Create the 'Group Membersships Query [Windows]' rule and update the description and command
Create the 'Group Membeships' output rule and update the description
Select the 'Root Rule Group' and export the 'Whitelist Profiler' rule group
Open the downloaded XML file, navigate to your two new rules, and update/fix the tracking ID (called 'externalId' in the XML file)


-wlp-content
scripts,gather,groups,
add two files, Groups-Windows.vbs and COCR-Groups-Windows.cmd. To test, copy cocr to rule to TE-wlp and test
to get the command refer to client side
scripts/Gather/Groups/COCR-Groups-Windows.cmd 
scripts/Gather/Groups/Groups-Windows.vbs 
whitelist,data,import,

on te, create query and output rules, copy, change, and import
cleanup wlp rules, export wlp rules, 
whitelist-profiler/data/import/wlp-combined-rules.xml 
replace file or update entire rules.xml

-wlp-common
src/main/java/com/tripwire/app/wlp/common/core/WhitelistType.java 
on enum WhiteListType change Group Membership to true

src/main/java/com/tripwire/app/wlp/common/groups/GroupsQuery.java
add final String CONTENT_SECTION_HEADER

-wlp-server
add new folder and java class
src/main/java/com/tripwire/app/wlp/server/groups/ServerGroupsQuery.java 
add entire file

add GROUPS section under switch whitelisttype 
src/main/java/com/tripwire/app/wlp/server/run/ProcessorTask.java 

add GroupsWhitelistFiles class to whitlistFileMap
src/main/java/com/tripwire/app/wlp/server/run/RunInitializer.java 

add tests
src/test/java/com/tripwire/app/wlp/server/groups/ServerGroupsQueryTest.java 

add group-membersghips-whitelist.csv file to String
src/test/java/com/tripwire/app/wlp/server/run/RunInitializerTest.java

add new file
src/test/resources/com/tripwire/app/wlp/server/run/group-memberships-whitelist.csv 

---------------------------------------------------------------SSR shares

On TE, On a clean/empty/fresh Console, import the latest rules XML file (or just install WLP to do this)
Create the 'Query Shares [Windows]' rule and update the description and command
to get the command refer to client side
Create the 'Shares' output rule and update the description

-wlp-content
create dir wlp-content/scripts/Gather/Shares
add two files, Shares-Windows.vbs and COCR-Shares-Windows.cmd. 
use other SSR vbs for reference and/or use CCR for reference. 
the cmd file is a single line file to run as VB. Remove all coments.
To test, copy cocr-shares-windows.cmd to query rule to TE-wlp and test

on TE, Select the 'Root Rule Group' and export the 'Whitelist Profiler' rule group
Open the downloaded XML file, navigate to your two new rules, and update/fix the tracking ID (called 'externalId' in the XML file)
431    <ExternalRule id="ID13" oid="-1y2p0ij32e8b6:-1y2p0ij2ytbsk" class="rule" name="Shares" externalId="tw-wlp-rules-server-output-shares">
654    <CommandExecutionCaptureRule id="ID56" oid="-1y2p0ij32e7qp:-1y2p0ij2ytbso" class="rule" name="Query Shares [Windows]" externalId="tw-wlp-rules-server-query-agent-windows-shares">
4	   <Rules generatingVersion="8.4.2">

-wlp-content
scripts/whitelist-profiler/data/import/
Paste the XML content into wlp-combined-rules.xml to overwrite the old version with the new file contents
- Run the 'processImportFiles' gradle task to clean/format the wlp-combined-rules.xml file

On TE, delete/clean out the old rules, policies, reports, too) and import the new wlp-combined-rules.xml file to test that it works as expected

-wlp-common
src/main/java/com/tripwire/app/wlp/common/core/WhitelistType.java 
on enum WhiteListType change Shares to true

src/main/java/com/tripwire/app/wlp/common/shares/SharesQuery.java
add
public static final String CONTENT_SECTION_HEADER = "shares output";

src/main/java/com/tripwire/app/wlp/common/core/Initializer
add the method setter and getter for includeAdminShares properties

 
-wlp-server
add new folder and java class
src/main/java/com/tripwire/app/wlp/server/shares/ServerSharesQuery.java 
add entire file

add SHARE section under switch whitelisttype 
src/main/java/com/tripwire/app/wlp/server/run/ProcessorTask.java 

add SharesWhitelistFiles class to whitlistFileMap
src/main/java/com/tripwire/app/wlp/server/run/RunInitializer.java 

add tests
src/test/java/com/tripwire/app/wlp/server/share/ServerSharesQueryTest.java 

add shares-whitelist.csv file to String
src/test/java/com/tripwire/app/wlp/server/run/RunInitializerTest.java

add new file
src/test/resources/com/tripwire/app/wlp/server/run/shares-whitelist.csv 

------------------------------------------------------------------E-12814 'Node Name' report field
B-92718 Optionally include a 'Node Name' report field in order to provide node context


From IntelliJ
wlp-server and wlp-common
checkout as scm/phi
VCS update project

create branch E-99999

wlp-server------------------------
src.main.resources
com.tripwire.app.wlp.server.postinstall
gvMigration.csv
add line 31 - 
,tw.wlp.server.includeNodeNames,"Include the node name on all Output rules reports. Boolean (true or false) - Default: false",false,,
src.main.java 
com.tripwire.app.wlp.server
ServerInitializer
method retrieveProps, case process_external_data, add setIncludedNodeNames


wlp-common------------------------
src.main.java

com.tripwire.app.wlp.common.core

abstractReporter
 isIncludeNodeNames in method enerateCsvHeader

Initializer
 add Global variable
 private static boolean includeNodeName;

 
--com.tripwire.app.wlp.common.ports
PortsReporter

--com.tripwire.app.wlp.common.users
UsersReporter

--com.tripwire.app.wlp.common.ports
SoftwareReporter

--com.tripwire.app.wlp.common.services
ServicesReporter


method generateSingleItem 
add string nodeName
add initializer.isIncludeNodeName with !reporttype GRC 
method generateAllowedSingleItem
add string nodeName
add initializer.isIncludeNodeName


src.main.test.java

com.tripwire.app.wlp.common.ports
PortsReporterTest
test 652 testPrettyDocumentationOutputWithLineNumbers 
to 
test 1268 testCsvUnusedOutputWithLineNumbers

1973 new tests
    // Enable node names
    Initializer.setIncludeNodeNames(true);
	
	// Disable node names
    Initializer.setIncludeNodeNames(false);

	                            "Node Name: test.example.com" + Constants.ls +
	

--com.tripwire.app.wlp.common.users
UserxReporterTest
test 584 testPrettyDocumentationOutputWithLineNumbers
to 
test 1129 testCsvUnusedOutputWithLineNumbers
1755 new tests

--com.tripwire.app.wlp.common.software
test 512 testPrettyDocumentationOutputWithLineNumbers
to 
test 972 testCsvUnusedOutputWithLineNumbers
1518 new tests 
	
--com.tripwire.app.wlp.common.services
test 486 testPrettyDocumentationOutputWithLineNumbers
to 
test 920 testCsvUnusedOutputWithLineNumbers
1440 new tests

                            "Node Name: test.example.com" + Constants.ls +
							"Node Name",
							"test.example.com",
							
--com.tripwire.app.wlp.common.routes
test 533 testPrettyDocumentationOutputWithLineNumbers
to 
test 908 testCsvUnusedOutputWithLineNumbers
1363 new tests

                            "Node Name: test.example.com" + Constants.ls +
							"Node Name",
							"test.example.com",						

--com.tripwire.app.wlp.common.shares
test 545 testPrettyDocumentationOutputWithLineNumbers
to 
test 932 testCsvUnusedOutputWithLineNumbers
1399 new tests

                            "Node Name: test.example.com" + Constants.ls +
							"Node Name",
							"test.example.com",
							
--com.tripwire.app.wlp.common.groups
test 482 testPrettyDocumentationOutputWithLineNumbers
to 
test 911 testCsvUnusedOutputWithLineNumbers

1424 new tests
    // Enable node names
    Initializer.setIncludeNodeNames(true);
	
	// Disable node names
    Initializer.setIncludeNodeNames(false);

                            "Node Name: test.example.com" + Constants.ls +
							"Node Name",
							"test.example.com",							

-----------------------------------------------------------------------E-12815: FIM Software Report

wlp-common
SoftwareReporter
add fim header line 51
on generate method
use new fim header line 128
add FIM report type,  line 223
exclude timestamp on usused report type, line 292, and use it in 296
add report type FIM, line 333

add tests, line 2021

wlp-server
build.gradle 
add dependency for cypher 2.1.0

ProcessortTask
add   public static final String SOFTWARE_FIM_OUTPUT, line 103 
add processing to FIM, line 277

old.... a lot more 


----------------------------------------E-13095 Add install date to sofware
build from scm/phi 
modify command to display install date

wlp-content
script/Gather/Software/Software-Windows.vbs
75     objReg.GetStringValue hklm,key,e2,v2
79 	   WScript.Echo v1 & "|||" & v3 & "|||" & v4 & "|||" & v2
86	   WScript.Echo quickFix.HotFixID & "||||||Microsoft Corporation|||" & quickFix.InstalledOn

script/Gather/Software/Software-linux.sh
38		RPMOUT=`$RPMBIN -qa --queryformat "%{NAME}$GETARCHFLAG-%{VENDOR}|||%{VERSION}$GETRELEASEFLAG|||%{VENDOR}|||%{INSTALLTIME}\\\n"`;
46 		 echo "FATAL: \`$RPMBIN -qa --queryformat \"%{NAME}$GETARCHFLAG-%{VENDOR}|||%{VERSION}$GETRELEASEFLAG|||%{VENDOR}|||%{INSTALLTIME}\\n\"\` exited with an error. Unable to .... 


wlp-server
software/ServerQuery
changes to processItems
add support for the install date for windows and linux

wlp-common
src/main/java/common/software/softwareItem
add constructor when vendor and install date are null or any one them are null
add setters and getters for installDate

wlp-common
src/main/java/common/software/SoftwareReporter
add softwarereporter lass, private Strings
field_install_date
add ield_install_date to csv_header and csv_header_actuals





wlp-common 
src/trest/jave/software/SoftwareReporterTest
add dates tp SoftwareItem ArrayList
make changes to all tests
did not do 
320   public void testPrettyAllowedOutput() throws WLPException {
393   public void testCsvAllowedOutput() throws WLPException {
446	  public void testPrettyUnusedOutput() throws WLPException {
478	  public void testCsvUnusedOutput() throws WLPException {
765   public void testPrettyAllowedOutputWithLineNumbers() throws WLPException {
850   public void testCsvAllowedOutputWithLineNumbers() throws WLPException {
909   public void testPrettyUnusedOutputWithLineNumbers() throws WLPException {
945   public void testCsvUnusedOutputWithLineNumbers() throws WLPException {
1241  public void testPrettyAllowedOutputWithAllowedHostsField() throws WLPException {
1326  public void testCsvAllowedOutputWithAllowedHostsField() throws WLPException {
1385   public void testPrettyUnusedOutputWithAllowedHostsField() throws WLPException {
1426   public void testCsvUnusedOutputWithAllowedHostsField() throws WLPException {
1721   public void testPrettyAllowedOutputWithNodeNames() throws WLPException {
1806  public void testCsvAllowedOutputWithNodeNames() throws WLPException {
1865   public void testPrettyUnusedOutputWithNodeNames() throws WLPException {
1905 public void testCsvUnusedOutputWithNodeNames() throws WLPException {





-----run data windwos
SQL Server 2008 R2 Database Engine Shared|||10.50.1600.1|||Microsoft Corporation|||20180126
Tripwire Enterprise Agent|||8.5.5|||Tripwire, Inc.|||20180222
Sql Server Customer Experience Improvement Program|||10.50.1600.1|||Microsoft Corporation|||20180126
SQL Server 2008 R2 Database Engine Services|||10.50.1600.1|||Microsoft Corporation|||20180126
SQL Server 2008 R2 Database Engine Services|||10.50.1600.1|||Microsoft Corporation|||20180126
Microsoft Report Viewer Redistributable 2008 SP1||||||Microsoft Corporation|||
Microsoft SQL Server Compact 3.5 SP2 ENU|||3.5.8080.0|||Microsoft Corporation|||20180126
Java Auto Updater|||2.8.144.1|||Oracle Corporation|||20180126
Microsoft Visual Studio Tools for Applications 2.0 - ENU|||9.0.35191|||Microsoft Corporation|||20180126
Hotfix for Microsoft Visual Studio 2007 Tools for Applications - ENU (KB946040)|||1|||Microsoft Corporation|||
Hotfix for Microsoft Visual Studio 2007 Tools for Applications - ENU (KB946308)|||1|||Microsoft Corporation|||
Hotfix for Microsoft Visual Studio 2007 Tools for Applications - ENU (KB946344)|||1|||Microsoft Corporation|||
Hotfix for Microsoft Visual Studio 2007 Tools for Applications - ENU (KB947540)|||1|||Microsoft Corporation|||
Hotfix for Microsoft Visual Studio 2007 Tools for Applications - ENU (KB947789)|||1|||Microsoft Corporation|||
Microsoft Office 2003 Web Components|||12.0.6213.1000|||Microsoft Corporation|||20180126
Microsoft Visual Studio 2008 Shell (integrated mode) - ENU|||9.0.30729|||Microsoft Corporation|||20180126
Microsoft SQL Server Browser|||10.50.1600.1|||Microsoft Corporation|||20180126
Microsoft Report Viewer Redistributable 2008 (KB971119)|||9.0.30731|||Microsoft Corporation|||20180126
Microsoft SQL Server 2008 R2 Policies|||10.50.1600.1|||Microsoft Corporation|||20180126
Microsoft SQL Server Compact 3.5 SP2 Query Tools ENU|||3.5.8080.0|||Microsoft Corporation|||20180126
KB2868626||||||Microsoft JJ Corporation|||5/5/2018
KB2883200||||||Microsoft JJ Corporation|||5/5/2018
KB2887595||||||Microsoft JJ Corporation|||5/5/2018
KB2894852||||||Microsoft JJ Corporation|||5/7/2018
KB2894856||||||Microsoft JJ Corporation|||5/7/2018
KB2903939||||||Microsoft JJ Corporation|||5/5/2018
KB2911106||||||Microsoft JJ Corporation|||5/5/2018
KB2919355||||||Microsoft JJ Corporation|||5/6/2018
KB2919394||||||Microsoft JJ Corporation|||5/5/2018
KB2928680||||||Microsoft JJ Corporation|||5/5/2018
KB2931366||||||Microsoft JJ Corporation|||5/5/2018
KB2938066||||||Microsoft JJ Corporation|||5/7/2018
KB2954879||||||Microsoft JJ Corporation|||5/7/2018
KB2966826||||||Microsoft JJ Corporation|||5/7/2018
KB2966828||||||Microsoft JJ Corporation|||5/7/2018
KB2967917||||||Microsoft JJ Corporation|||5/7/2018
KB2968296||||||Microsoft JJ Corporation|||5/7/2018
KB2972103||||||Microsoft JJ Corporation|||5/7/2018


 perl-threads-shared-CentOS|||1.43|||CentOS|||1504801564
 
--------------
    
Make some improvements to the element querying used by WLP. Right now we basically have 1 REST query that gets the latest 
element versions for the WLP query rules. However, TE performance often sucks (being blunt) due to many factors, and this
1 query can take longer than 1 minute to finish, which causes WLP to fail (it only waits up to 1 minute currently).

So the idea is that we would break that 1 REST query into 1 per WLP query rule. This also would allow us to improve another
situation that PHI just shot themselves in the foot with: WLP currently gets the latest element versions of ANY query element, 
when it only needs the latest version from 1 element. This isn't an issue if the customer uses WLP as designed. But if they 
start messing with our published rules, this can become an issue (as PHI did).
 
There are 4 types of element versions: addition, removal, modification, or baseline
So I guess a 'non removal' version would be one of the 3 that is NOT a removal type

The SOAP and REST APIs are accessed by two different URLs and also use very different technologies. So if need to do something
with the SOAP API, you need to use the SOAP client. For REST, use the REST client.

for elements query, only fix query versions and not output rules since we create those 
 
 
 
2018-10-19 10:09:53.146-0700 [main] INFO  c.t.a.wlp.server.run.RunInitializer  - 
Found [ElementVersion[id=-1y2p0ij32e8dl:-1y2p0ij2xkm6u,
elementName=Open Ports,
nodeName=demetrius.ts.lab.tripwire.com,
ruleName=Query Open Ports [RHEL],
elementId=-1y2p0ij32e8di:-1y2p0ij2xkm6v,
nodeId=-1y2p0ij32e8aj:-1y2p0ij2yemks,
ruleId=-1y2p0ij32e8da:-1y2p0ij2xc12m,
baselineVersion=-1y2p0ij32e8dl:-1y2p0ij2xkm6u,
changeType=BASELINE,
exists=true,severity=0,
timeDetected=2017-04-21T22:08:13.000Z,
timeReceived=2017-04-21T22:08:16.000Z,
promotionComment=,approvalId=,
outsideMaintenanceWindow=false,scanId=<null>,
md5=789C015056E0877D9CCF04A19C80FC6E,sha1=,sha256=,sha512=,isPromoted=false], 

ElementVersion[id=-1y2p0ij32e8dl:-1y2p0ij2xkm6w,
elementName=Services,
nodeName=demetrius.ts.lab.tripwire.com,
ruleName=Query Services [RHEL],
elementId=-1y2p0ij32e8di:-1y2p0ij2xkm6x,
nodeId=-1y2p0ij32e8aj:-1y2p0ij2yemks,
ruleId=-1y2p0ij32e8da:-1y2p0ij2xc12x,
baselineVersion=-1y2p0ij32e8dl:-1y2p0ij2xkm6w,
changeType=BASELINE,exists=true,severity=0,
timeDetected=2017-04-21T22:08:13.000Z,
timeReceived=2017-04-21T22:08:15.000Z,
promotionComment=,approvalId=,
outsideMaintenanceWindow=false,scanId=<null>,
md5=180F9A293AE7DE49F3D63D6D09EFD06B,sha1=,sha256=,sha512=,isPromoted=false], 

ElementVersion[id=-1y2p0ij32e8dl:-1y2p0ij2xkm6s,elementName=Software,nodeName=demetrius.ts.lab.tripwire.com,ruleName=Query Software [RHEL],elementId=-1y2p0ij32e8di:-1y2p0ij2xkm6t,nodeId=-1y2p0ij32e8aj:-1y2p0ij2yemks,ruleId=-1y2p0ij32e8da:-1y2p0ij2xc12u,baselineVersion=-1y2p0ij32e8dl:-1y2p0ij2xkm6s,changeType=BASELINE,exists=true,severity=0,timeDetected=2017-04-21T22:08:17.000Z,timeReceived=2017-04-21T22:08:20.000Z,promotionComment=,approvalId=,outsideMaintenanceWindow=false,scanId=<null>,md5=C19C3A809D287F60A66851E4B4F64714,sha1=,sha256=,sha512=,isPromoted=false], ElementVersion[id=-1y2p0ij32e8dl:-1y2p0ij2xkm6y,elementName=Users,nodeName=demetrius.ts.lab.tripwire.com,ruleName=Query Users [RHEL],elementId=-1y2p0ij32e8di:-1y2p0ij2xkm6z,nodeId=-1y2p0ij32e8aj:-1y2p0ij2yemks,ruleId=-1y2p0ij32e8da:-1y2p0ij2xc12t,baselineVersion=-1y2p0ij32e8dl:-1y2p0ij2xkm6y,changeType=BASELINE,exists=true,severity=0,timeDetected=2017-04-21T22:08:10.000Z,timeReceived=2017-04-21T22:08:13.000Z,promotionComment=,approvalId=,outsideMaintenanceWindow=false,scanId=<null>,md5=815170B29696570E441D8A4C6877B8D9,sha1=,sha256=,sha512=,isPromoted=false], ElementVersion[id=-1y2p0ij32e8dl:-1y2p0ij32akgp,elementName=Users,nodeName=vortex.ts.lab.tripwire.com,ruleName=Query Users [Windows],elementId=-1y2p0ij32e8di:-1y2p0ij32akgq,nodeId=-1y2p0ij32e8ak:-1y2p0ij32ams6,ruleId=-1y2p0ij32e8da:-1y2p0ij2xc12q,baselineVersion=-1y2p0ij32e8dl:-1y2p0ij32akgp,changeType=BASELINE,exists=true,severity=0,timeDetected=2017-07-18T05:48:50.000Z,timeReceived=2017-07-18T05:48:34.000Z,promotionComment=,approvalId=,outsideMaintenanceWindow=false,scanId=<null>,md5=814124DC8A9DF787E4B239E314B7B8E7,sha1=,sha256=,sha512=,isPromoted=false]] element 5 JOP associated with the query rules

 am looking at runinitializer line 227.   let me know if I am cold. My plan is to be able to (for now) restrict to say just open ports elements... if all goes well I would make 4 calls
 
 


So there will need to be a few key changes:

 
1.ElementProcessor.getElementVersions() will need to be updated or a new method will need to be created in order to accept List<Rule>. This way we can search for elements based on the rule ID and the element name defined in the Rule (we'll need to confirm we can get this, but we should be able to). 
2.In RunInitializer, you'll need to loop through each of the query rules that were captured earlier in the initialization process and use the new/updated ElementProcessor.getElementVersions() method to query the element versions for each query rule. This means that we will execute one REST query per query rule, instead of one REST query for all query rules as we have now. 


I guess I misspoke in #1. You wouldn't have to update it to accept List<Rule>, it would just be Rule by itself (since you'll be executing the REST query for just 1 rule at a time.
Eh, I wouldn't worry about that. The logic doesn't care what the rule actually gathers, so limiting it to ports wouldn't make any difference...if that makes sense.
Ah, crap. And just our luck....REST API version 1.12 does NOT provide element name info on Rule objects....sigh
 
 I understand your intention. You could do that. My point is merely that it's not necessary as they code has no knowledge/doesn't care if the query rule is for ports or users or chicken or whatever. So you'd have to write extra code to limit it to just ports....extra code that wouldn't be there in the final version anyway.
I'm trying to figure out what version of the REST API added the capability to get element name from the Rule object
version 1.13

Over time we increase the minimum required version. This 5.2 release already is bumping up the minimum required from 1.4.2 to 1.12. Which essentially means that TE 8.6.0 is the new minimum requirement.

8.6 only came out 13 months ago. If we change the min required to 1.13 (which means TE 8.6.2), then we're requiring customers have a release no older than 8 months ago.

Yes, customers should always be updating. But as you know from consulting, customers often don't and end up running very very old versions.

So we try to be somewhat accommodating, but also use the requirements to push customers to upgrade somewhat regularly.


One idea I had, though, which would let us ship this improvement in this release: if customer's API is 1.13 or newer, use the improvement. If the API is 1.12, then use the old.

Close. If it's 1.12, execute the code as it is today. If it's 1.13 or newer, use the enhancement you will be writing.

CreateCSRulesInitializerIntTest
https://atlantia.ts.lab
jordonez/Passphrase12#

------------------------------------------------------------
E-13544: Solaris: Report 'Vendor' and 'Install Date' fields
B-97944: Solaris: Report 'Vendor' and 'Install Date' fields to provide additional context for software items


from scm/phi
E-13544 add installed date and vendor to solaris

on wlp-content
scripts/server-side/query/software/COCR-Software-Solaris.sh 
scripts/server-side/query/software/Software-Solaris.sh 
change pkginfo to pkginfo -lc application


on wlp-server
software/ServerSoftwareQuery
validateSoftwareItem for Solaris
add string vendor and zoneddate install date
case SOLARIS
add logic to get software items and map records 

software/ServerSoftwareQueryTests
add solaris test


E-13544: Solaris Report - Add Install Date and Vendor

== AFFECTED AREAS
The ServerSoftwareQuery class was modified to account for Solaris report
containing multiple lines per package installed.

== DETAILS
New code was written to parse each record or package and to extract the
fields, package name, version, vendor, and install date


---------------
dellll

        for (String softwareItem : softwareItems) {
          logger.debug("Parsing software item line: \"{}\"", softwareItem);

          name = null;
          version = null;
          vendor = null;
          installDate = null;

//          String[] rec = softwareItem.split("\\r?\\n");
//          for (String xx : rec) {
//            //System.out.println("."+xx);
//            if (xx.contains("PKGINST")) {
//              String[] recName = xx.split("PKGINST:");
//              name = recName[1].trim();
//              logger.debug("JoP"+name+"JoP");
//            } else if (xx.contains("VERSION")) {
//              String[] recVersion = xx.split("VERSION:");
//              version = recVersion[1].trim();
//            }
//          }
          //} else if (xx.contains("INSTDATE")) {
          //String[] recInstdate = xx.split("INSTDATE:");
          //installDate =
          //LocalDate.parse(recInstdate[1], DateTimeFormatter.ofPattern("MMM dd yyyy HH:mm"))
          //.atStartOfDay(ZoneOffset.UTC);
          //}

//          if (StringUtils.isNotBlank(name) && StringUtils.isNotBlank(version)) {
          //if (name != null) {
		  
		  


        // include vendor
        // optional instdate and vendor
        // required name , version,
        // add validation for name, version		 

//          if (StringUtils.isNotBlank(name) && StringUtils.isNotBlank(version)) {
          //if (name != null) {		
		  
		  
          Map<String, String> map = Arrays.stream(softwareItem.split("\\r?\\n"))
            .map(s -> s.split(":  "))
           .collect(Collectors.toMap(a -> a[0].trim(), a -> a[1].trim(), (v1, v2) -> v1));

            //Map<String, String> map = Arrays.stream(softwareItem.split("\\r?\\n"))
            //  .collect(Collectors.toMap(s -> s.toString().split(":  ")[0].trim(), s -> s.toString().split(":  ")[1].trim(), (v1, v2) -> v1));		  
			
			
-------------------------
Groups Membership include domain computers D-12696
wlp-server, resources, gvMigration. 
add line 19 ,tw.wlp.groups.includeDomainComputers,"For descriptions of global variables, see 'Appendix I. Global Variables for Tripwire Whitelist Profiler' in the Tripwire Whitelist Profiler Implementation Guide",true,,


wlp-common, core, Initializer
add line 132 private static boolean includeDomainComputers= Constants.GROUPS_INCLUDE_DOMAIN_COMPUTERS; 

wlp-commom, core, Constants
add line 44 public static final boolean GROUPS_INCLUDE_DOMAIN_COMPUTERS = true;	

wlp-common, core, Initializer
add line 601 
public static boolean isIncludeDomainComputers() {
    return includeDomainComputers;
  }

  /**
   * Determines if domain computers should be included in report outputs or not. Designed to be used in tests.
   *
   * @param includeDomainComputers if domain computers should be included
   */
  public static void setIncludeDomainComputers(boolean includeDomainComputers) {
    Initializer.includeDomainComputers = includeDomainComputers;

    logger.debug("Set 'includeDomainComputers' to \"{}\"", Initializer.includeDomainComputers);
  }

  public void setIncludeDomainComputers(String property) throws WLPConfigException {
    includeDomainComputers = getBooleanProp(property, Constants.GROUPS_INCLUDE_DOMAIN_COMPUTERS);

    logger.debug("Set 'includeDomainComputers' to \"{}\"", includeDomainComputers);
  }
		

wlp-server, groups, ServerGroupsQueryTest
add line 116
	if (!Initializer.isIncludeDomainComputers() && StringUtils.endsWith(memberName, "$")) {
        logger.trace("Skipping group membership with values: [{}] : [{}] (member \"{}\" is a domain computer)", groupName, memberName, memberName);
        continue;
    }
	
ServerGroupsQuerytests
add tests
line 257

==========================PID for FIM reports B-110234
wlp-server, resources, gvMigration. 
add line 22, ,tw.wlp.ports.excludeFimReportPid,"For descriptions of global variables, see 'Appendix I. Global Variables for Tripwire Whitelist Profiler' in the Tripwire Whitelist Profiler Implementation Guide",false,,


wlp-common, core, Initializer
add 
line 125   private static boolean excludeFimReportPid;


line 447
  public static boolean isExcludeFimReportPid() {
    return excludeFimReportPid;
  }

  /**
   * Determines if Process ID of PID open ports should be queried or not. Designed to be used in tests.
   *
   * @param excludeFimReportPid if Precess ID open ports should be queried
   */
  public static void setExcludeFimReportPid(boolean excludeFimReportPid) {
    Initializer.excludeFimReportPid = excludeFimReportPid;

    logger.debug("Set 'excludeFimReportPid' to \"{}\"", Initializer.excludeFimReportPid);
  }

  public void setExcludeFimReportPid(String property) throws WLPConfigException {
    excludeFimReportPid = getBooleanProp(property, false);

    logger.debug("Set 'excludeFimReportPid' to \"{}\"", excludeFimReportPid);
  }
  
  
line 783
    // exclude PID
    setExcludeFimReportPid("tw.wlp.ports.excludeFimReportPid");
	

wlp-common, ports, PortsRepoter
add line 
51   private static final String[] CSV_HEADER_EXCLUDE_PID = {FIELD_PROTOCOL, FIELD_PORT, FIELD_PROCESS_NAME};


line 133 - modify to use CSV_HEADER_EXCLUDE_PID for FIM
    if (useCsvFormat && !reportType.equals(ReportType.GRC_READY)) {
      if (!reportType.equals(ReportType.FIM) || !Initializer.isExcludeFimReportPid()) {
        csvWriter.writeNext(generateCsvHeader(whitelist, CSV_HEADER).toArray(new String[0]));
      } else {
        csvWriter.writeNext(generateCsvHeader(whitelist, CSV_HEADER_EXCLUDE_PID).toArray(new String[0]));
      }
    }

line 324  - modify to FIM report and Initializer.isExcludeFimReportPid()
    if (!reportType.equals(ReportType.FIM) || !Initializer.isExcludeFimReportPid()) {
      if (useCsvFormat) {
        output.add(formatField(FIELD_PROCESS_ID, pid.equals(REPORT_UNAVAILABLE_STRING) ? REPORT_NOT_APPLICABLE_STRING : pid, true));

        // For text format, only output the PID if available
      } else if (!pid.equals(REPORT_UNAVAILABLE_STRING)) {
        output.add(formatField(FIELD_PROCESS_ID, pid, false));
      }
    }

 
wlp-common, test, ports, PortsReporterTest.

line 34
import static com.tripwire.app.wlp.common.core.Initializer.setExcludeFimReportPid;

add tests 

line 166, 264, 411, 507 
	
	
-----------------------SUSE SSR 
On a clean/empty/fresh Console, import the latest rules XML file (or just install WLP to do this)
Create new 'SLES' rule group under WLP, SSR, Query Rules, Agent
Copy RHEL rules, Ports, services, software, users, and update the description
add new group - Custom Software Query rules

On Policies
create new policy - WLP, Generic Policies, SLES - Whitelist Profiler
create new groups - Open Ports, Services, Software, Users
Copy tests from RHEL and change Name, remove deprecated rules, 
create new policy - WLP, NERC CIP Policies, SLES - Whitelist Profiler - NERC CIP
create groups CIP-004-6 R4, CIP-005-5 R1, CIP-007-6 R1, CIP-007-6 R2, CIP-010-2 R1
link users from SLES Generic policies to CIP-004-6 R4
link ports, services from SLES Generic policies to CIP-007-6 R1
link software from SLES Generic policies to CIP-007-6 R2
link ports, software from SLES Generic policies to CIP-010-2 R1

Check WLP, SSR, Output rules, for SLES test "Ensure No Unauthorized Open Ports Exist [SUSE] " for ports, users, software, services


Select the 'Root Rule Group' and export the 'Whitelist Profiler' rule group
Open the downloaded XML file, navigate to your two new rules, and update/fix the tracking ID (called 'externalId' in the XML file)

Select policies and 



-wlp-content
export wlp rules from console, add external IDs to SLES rules, then import on console 

whitelist-profiler/data/import/
wlp-combined-rules.xml
Replace content of file with the new xml
Run the 'processImportFiles' gradle task to clean/format the wlp-combined-rules.xml file

scripts/server-side/query/ports/OpenPorts-Linux.sh
chanfe tunln to tunlpa for the ss commands

-wlp-common
src/main/java/com/tripwire/app/wlp/common/core/PlatformType
add emun for SLES

src/main/java/com/tripwire/app/wlp/common/util/validation
add   public static boolean validateLinuxXinetdSysVServiceRecord(String service) {
        return service.matches("\\S+:\\s+(?:off|on)");
  }
line 325 , add .* at the end
    public static boolean validateLinuxSysVServiceRecord(String service) {
    return service.matches("\\S+\\s+(?:[0-6]:(?:off|on)\\s+){6}[0-6]:(?:off|on).*");
  }


-wlp-server
src/main/java/com/tripwire/app/wlp/server/
run/RunInitializer
add SLES platform to determinePlatform function (it was there already, just modify)

services
on ServerServicesQuery 
ServerServiceQuery function, add case SLES: under case LINUX:
validateServices funciton, add case SLES: under case LINUX:
processChkconfigServices, add else if (Validation.validateLinuxXinetdSysVServiceRecord(record)) 

software
on ServerSoftwareQuery
ServerSoftwareQuery function, add case SLES: under case LINUX:
validateServices funciton, add case SLES: under case LINUX:

users
ServerUsersQuery
on ServerUsersQuery functions 
add SLES platform

ports
ServerPortsQuery function, add case SLES: under case LINUX:
validatePorts funciton, add case SLES: under case LINUX:

tests
add tests to serverServicesqueryTest

-------------------------------add CentOS support
get sml rules from wlp-content, and import into a new te console 
Create new 'CentOs' rule group under WLP, SSR, Query Rules, Agent
Copy RHEL rules, Ports, services, software, users, and update the description
add new group - Custom Software Query rules

wlp-common
add Centos on platformType enum

-wlp-content
export wlp rules from console, add external IDs to CentOS rules, 
   
	<CommandExecutionCaptureRule id="ID124" oid="-1y2p0ij32e7qp:-1y2p0ij2rysml" class="rule" name="Query Software [CentOS]" externalId="tw-wlp-rules-server-query-agent-centos-software">
    <CommandExecutionCaptureRule id="ID128" oid="-1y2p0ij32e7qp:-1y2p0ij2rysmh" class="rule" name="Query Users [CentOS]" externalId="tw-wlp-rules-server-query-agent-centos-users">
    <CommandExecutionCaptureRule id="ID127" oid="-1y2p0ij32e7qp:-1y2p0ij2rysmi" class="rule" name="Query Open Ports [CentOS]" externalId="tw-wlp-rules-server-query-agent-centos-open-ports">
    <CommandExecutionCaptureRule id="ID126" oid="-1y2p0ij32e7qp:-1y2p0ij2rysmj" class="rule" name="Query Services [CentOS]" externalId="tw-wlp-rules-server-query-agent-centos-services">
    <CommandExecutionCaptureRule id="ID125" oid="-1y2p0ij32e7qp:-1y2p0ij2rysmk" class="rule" name="Query Routes [CentOS]" externalId="tw-wlp-rules-server-query-agent-centos-routes">
    <RuleGroup id="ID82" class="rulegroup" name="CentOS" externalId="tw-wlp-rules-server-query-agent-centos-group">

	
then import on console to test it does improt and looks right 

whitelist-profiler/data/import/
wlp-combined-rules.xml
Replace content of file with the new xml
Run the 'processImportFiles' gradle task to clean/format the wlp-combined-rules.xml file

fix the service query rule to accomodate centos 8

wlp-server 
on RunInitializer, add PlatformType CENTOS
on ServerPortsQuery, add case CentOS for ServerPortsQuery and validatePorts
do same for routes, services, software, 
for ServerUsersQuery add CENTOS to ServerUsersQuery

on te console 
 
On Policies
create new policy - WLP, Generic Policies, CentOS - Whitelist Profiler
create new groups - Open Ports, Services, Software, Users
Copy tests from RHEL and change Name, enabled tracking identifier, and remove deprecated rules 

create new policy - WLP, NERC CIP Policies, SLES - Whitelist Profiler - NERC CIP
create groups CIP-004-6 R4, CIP-005-5 R1, CIP-007-6 R1, CIP-007-6 R2, CIP-010-2 R1
link users from CentOS Generic policies to CIP-004-6 R4
link ports, services from CentOS Generic policies to CIP-007-6 R1
link software from CentOS Generic policies to CIP-007-6 R2
link ports, software from CentOS Generic policies to CIP-010-2 R1
link routes from CentOS Generic policies to CIP5-5 R1


Select the 'Root Rule Group' and export the 'Whitelist Profiler' rule group
Open the downloaded XML file, navigate to your new itmes  and update/fix the tracking ID (called 'externalId' in the XML file)



	
    <Policy id="ID10" class="" name="CentOS - Whitelist Profiler" externalId="tw-wlp-policies-generic-centos-policy">
    <TestGroup id="ID69" class="testgroup" name="Open Ports"      externalId="tw-wlp-policies-generic-centos-open-ports-group">
	<TestGroup id="ID70" class="testgroup" name="Routes"          externalId="tw-wlp-policies-generic-centos-routes-group">	
    <TestGroup id="ID71" class="testgroup" name="Services"        externalId="tw-wlp-policies-generic-centos-services-group">	
    <TestGroup id="ID72" class="testgroup" name="Software"        externalId="tw-wlp-policies-generic-centos-software-group">	
    <TestGroup id="ID73" class="testgroup" name="Users"           externalId="tw-wlp-policies-generic-centos-users-group">
	
	<Policy id="ID86" class="" name="CentOS - Whitelist Profiler - NERC CIP" externalId="tw-wlp-policies-cip-centos-policy">	
	<TestGroup id="ID115" class="testgroup" name="CIP-004-6 R4"   externalId="tw-wlp-policies-cip-centos-cip-004-6-r4-group">	
	<TestGroup id="ID116" class="testgroup" name="CIP-005-5 R1"   externalId="tw-wlp-policies-cip-centos-cip-005-5-r1-group">	
	<TestGroup id="ID117" class="testgroup" name="CIP-007-6 R1"   externalId="tw-wlp-policies-cip-centos-cip-007-6-r1-group">
  	<TestGroup id="ID118" class="testgroup" name="CIP-007-6 R2"   externalId="tw-wlp-policies-cip-centos-cip-007-6-r2-group">  
	<TestGroup id="ID119" class="testgroup" name="CIP-010-2 R1"   externalId="tw-wlp-policies-cip-centos-cip-010-2-r1-group">
	


    <PolicyTest id="ID78" name="Ensure No Unauthorized Users Exist [CentOS]" externalId="tw-wlp-policies-centos-users-unauth-test">
    <PolicyTest id="ID77" name="Ensure No Unauthorized Software Exists [CentOS]" externalId="tw-wlp-policies-centos-software-unauth-test">
    <PolicyTest id="ID76" name="Ensure No Unauthorized Services Exist [CentOS]" externalId="tw-wlp-policies-centos-services-unauth-test">
    <PolicyTest id="ID75" name="Ensure No Unauthorized Routes Exist [CentOS] " externalId="tw-wlp-policies-centos-routes-unauth-test">
    <PolicyTest id="ID74" name="Ensure No Unauthorized Open Ports Exist [CentOS]" externalId="tw-wlp-policies-centos-open-ports-unauth-test">







then save and import into Te Console, ensure these work
then copy paste into content 
wlp-combined-policies.xml
run processImportFiles
 

------------------JEA, add a GV to disable port filtering
src.main.resources.com.tripwire.app.wlp.server.postinstall.gvMigration.csv
add line 24 
,tw.wlp.ports.disableFilter,"For descriptions of global variables, see 'Appendix I. Global Variables for Tripwire Whitelist Profiler' in the Tripwire Whitelist Profiler Implementation Guide",false,,



src.main.resources.com.tripwire.app.wlp.server.ServerInitializer

add Global Properties 
private static boolean disableFilter;

add Global Properties getters/setters 
  public static boolean isDisableFilter() {
    return disableFilter;
  }

  /**
   * Determines if port disable filter should be performed in report outputs or not. Designed to be used in tests.
   *
   * @param disableFilter if ports filtering should be included
   */
  public static void setDisableFilter(boolean disableFilter) {
    ServerInitializer.disableFilter = disableFilter;
    logger.debug("Set 'ports filtering' to \"{}\"", ServerInitializer.disableFilter);
  }

  public void setDisableFilter(String property) throws WLPConfigException {
    disableFilter = getBooleanProp(property, false);

    logger.debug("Set 'ports disable filter' to \"{}\"", disableFilter);
  }
  
add Parse Open Ports properties
	Standard properties
  
          // disableFilter
          setDisableFilter("tw.wlp.ports.disableFilter");  
		  
src.main.resources.com.tripwire.app.wlp.server.Ports.ServerPortsQuery

add ServerPortsQuery, case windows,
		          portRecords = getMatchedRecords(contentMap.get(WINDOWS_NETSTAT_CONTENT_SECTION_HEADER), pattern, IS_TCP_UDP_PORT);
 case linux....ubuntu  
              portRecords = getFilteredRecords(contentMap.get(LINUX_NETSTAT_CONTENT_SECTION_HEADER).split("\\r?\\n"), IS_TCP_UDP_PORT);
              portRecords = getFilteredRecords(contentMap.get(LINUX_SS_CONTENT_SECTION_HEADER).split("\\r?\\n"), IS_TCP_UDP_PORT);


add validatePorts, case winndows
          // A final filter to make sure we only process listening TCP or open UDP port records
            if ((protocol.equalsIgnoreCase("tcp") && state.toLowerCase().contains("listen")) || protocol.equalsIgnoreCase("udp") || ServerInitializer.isDisableFilter()) {
 case linux....ubuntu  	
            if ss outoput ...
	              // A final filter to make sure we only process listening TCP or open UDP port records
                if ((protocol.equalsIgnoreCase("tcp") && state.toLowerCase().contains("listen")) || protocol.equalsIgnoreCase("udp") || ServerInitializer.isDisableFilter()) {
			else ....
			              // A final filter to make sure we only process listening TCP or open UDP port records
              if ((protocol.equalsIgnoreCase("tcp") && state.toLowerCase().contains("listen")) || protocol.equalsIgnoreCase("udp") || ServerInitializer.isDisableFilter()) {
case aix, solaris
           // A final filter to make sure we only process listening TCP or open UDP port records (no destination)
            if ((protocol.equalsIgnoreCase("tcp") && state.toLowerCase().contains("listen")) ||
			              (protocol.equalsIgnoreCase("udp") && !parsedFields[8].contains("->")) || ServerInitializer.isDisableFilter() ) {
						  
src.main.resources.com.tripwire.app.wlp.server.Ports.ServerPortsQueryTest
add tests 1358 to 2147


src.main.resources.com.tripwire.app.wlp.client.ports.LinuxPortsquery			  
      ImmutableMap.of(DEFAULT_CONTENT_SECTION_HEADER, IS_TCP_UDP_PORT)).get(DEFAULT_CONTENT_SECTION_HEADER);

src.main.resources.com.tripwire.app.wlp.client.ports.windowsPortsquery			  

      ImmutableMap.of(WINDOWS_NETSTAT_CONTENT_SECTION_HEADER, IS_TCP_UDP_PORT));




